# VitalMonitor â€“ Dispositivo de Monitoramento de Sinais Vitais (Raspberry Pi Pico W)

Firmware para **dispositivo vestÃ­vel de monitoramento assistivo de saÃºde** baseado no **Raspberry Pi Pico W**.
Detecta **frequÃªncia cardÃ­aca (BPM)**, **saturaÃ§Ã£o de oxigÃªnio (SpOâ‚‚)** e **quedas** utilizando os sensores **MPU6050** (acelerÃ´metro/giroscÃ³pio) e **MAX30102** (oxÃ­metro de pulso).

Os dados sÃ£o enviados em tempo real via **MQTT** para o backend **HealthMonitor**, onde sÃ£o validados clinicamente, analisados por IA e transformados em alertas e relatÃ³rios.

**Objetivo principal:** Monitoramento contÃ­nuo de idosos e pacientes com risco cardiorrespiratÃ³rio, com **detecÃ§Ã£o precoce de quedas** e **anomalias vitais**.

---

## âœ¨ Funcionalidades Implementadas

* ConexÃ£o Wi-Fi estÃ¡vel usando **CYW43** (Pico W)
* PublicaÃ§Ã£o **MQTT** em broker pÃºblico (**EMQX**)

  * **Batimentos:** `embarca/batimentos`

    ```json
    { "deviceId": "...", "bpm": 72, "spo2": 97 }
    ```
  * **Quedas:** `embarca/quedas`

    * Estados: `queda_livre`, `impacto`, `QUEDA_CONFIRMADA`
* DetecÃ§Ã£o robusta de **queda em 3 fases**
* Leitura do **MAX30102** com mÃ©dia mÃ³vel e filtro de ruÃ­do
* Arquitetura com **FreeRTOS** (3 tarefas dedicadas)
* Logs detalhados via **UART** para debug e validaÃ§Ã£o em campo

---

## ğŸ§± Hardware Utilizado

| Componente          | Interface | Pinos Pico W             | EndereÃ§o I2C | Finalidade        |
| ------------------- | --------- | ------------------------ | ------------ | ----------------- |
| Raspberry Pi Pico W | â€”         | â€”                        | â€”            | MCU + Wi-Fi       |
| MPU6050             | I2C0      | GPIO0 (SCL), GPIO1 (SDA) | `0x68`       | DetecÃ§Ã£o de queda |
| MAX30102            | I2C1      | GPIO2 (SDA), GPIO3 (SCL) | `0x57`       | BPM e SpOâ‚‚        |

---

## ğŸ”Œ Diagrama de Pinagem (ConexÃµes FÃ­sicas)

### ConexÃµes Recomendadas

```text
Raspberry Pi Pico W
+-----------------------------+
| GPIO0 â”€â”€â”€ SCL â”€â”€â”€ MPU6050   |
| GPIO1 â”€â”€â”€ SDA â”€â”€â”€ MPU6050   |
|                             |
| GPIO2 â”€â”€â”€ SDA â”€â”€â”€ MAX30102 |
| GPIO3 â”€â”€â”€ SCL â”€â”€â”€ MAX30102 |
|                             |
| 3V3(OUT) â”€â”€â”€ VCC (sensores)|
| GND â”€â”€â”€â”€â”€â”€â”€â”€â”€ GND (todos)  |
+-----------------------------+
```

### Pinagem Detalhada

| Pino Pico | FunÃ§Ã£o      | Conectado a  | ObservaÃ§Ã£o              |
| --------- | ----------- | ------------ | ----------------------- |
| GPIO0     | I2C0 SCL    | MPU6050 SCL  | Pull-up interno/externo |
| GPIO1     | I2C0 SDA    | MPU6050 SDA  | Pull-up interno/externo |
| GPIO2     | I2C1 SDA    | MAX30102 SDA | Pull-up interno/externo |
| GPIO3     | I2C1 SCL    | MAX30102 SCL | Pull-up interno/externo |
| 3V3(OUT)  | AlimentaÃ§Ã£o | VCC sensores | **NÃ£o usar 5V**         |
| GND       | Terra       | GND sensores | GND comum               |

**Pull-ups I2C:**
O firmware ativa pull-ups internos via `gpio_pull_up()`.
Para maior estabilidade (especialmente cabos longos), recomenda-se **4.7kÎ© externos** entre SDA/SCL e 3.3V.

---

## ğŸ§  IntegraÃ§Ã£o com o Backend HealthMonitor

* Protocolo: **MQTT**
* Broker: **EMQX**
* Cada mensagem inclui `deviceId` para associaÃ§Ã£o com o paciente
* Backend realiza:

  * ValidaÃ§Ã£o clÃ­nica por atividade
  * DetecÃ§Ã£o de anomalias
  * Alertas (Telegram)
  * AnÃ¡lise preditiva por IA

---

## ğŸ§© Modelagem de Dados (VisÃ£o Geral)

A modelagem considera **empresa (SaaS)**, **usuÃ¡rios clÃ­nicos**, **pacientes**, **dispositivos**, **sinais vitais**, **atividades** e **prediÃ§Ãµes de risco**.

> Recomenda-se incluir no repositÃ³rio a imagem do **Diagrama Entidade-Relacionamento (ERD)** gerado a partir do schema Prisma.

Exemplo de inclusÃ£o no README:

```markdown
![Modelagem de Dados â€“ HealthMonitor](docs/images/healthmonitor-erd.png)
*Modelagem relacional do sistema HealthMonitor (Prisma + PostgreSQL)*
```

---

## ğŸ› ï¸ CompilaÃ§Ã£o e GravaÃ§Ã£o

> MantÃ©m o mesmo processo definido anteriormente para Pico SDK + FreeRTOS.
> (SeÃ§Ã£o nÃ£o repetida aqui para evitar duplicaÃ§Ã£o excessiva.)

---

## ğŸ§ª Logs Esperados (UART)

* Status da conexÃ£o Wi-Fi
* ConexÃ£o MQTT (publish/ack)
* Leitura bruta e filtrada do MAX30102
* Estados da mÃ¡quina de detecÃ§Ã£o de queda

---

## ğŸš€ PossÃ­veis Melhorias Futuras

* LED de status (conectado, leitura vÃ¡lida, queda)
* Envio periÃ³dico de **nÃ­vel de bateria**
* **Deep sleep** entre leituras
* Filtro de **Kalman** para aceleraÃ§Ã£o
* Feedback **sonoro/vibratÃ³rio** em queda confirmada

---

## ğŸ“„ LicenÃ§a

MIT

---

**VitalMonitor â€“ Pico Edition**
Projeto de dispositivo vestÃ­vel para monitoramento assistivo
Fortaleza, Brasil â€” 2026
